generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String
  name         String
  role         UserRole @default(employee)
  employeeId   String?  @unique
  internId     String?  @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  employee     Employee? @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  intern       Intern?   @relation(fields: [internId], references: [id], onDelete: Cascade)

  @@map("users")
}

model Employee {
  user                User?
  id                  String            @id @default(cuid())
  name                String
  email               String            @unique  // Personal/contact email (e.g., sparshsahu8435@gmail.com)
  loginEmail          String?           @unique  // Firebase login email (e.g., sapeksh@adrs.com)
  adrsId              String?           @unique  // ADRS Employee ID (manually assigned)
  avatarUrl           String?
  role                Role              @default(Developer)
  project             String            @default("Unassigned")  // Primary project (kept for backward compatibility)
  projects            String?           // JSON array of project names ["Project1", "Project2"]
  isActive            Boolean           @default(true)  // Employee active/deactivated status
  enrollmentDate      DateTime          @default(now())
  casualLeaveQuota    Int               @default(1)
  sickLeaveQuota      Int               @default(2)
  earnedLeaveQuota    Int               @default(0)
  maternityLeaveQuota Int               @default(0)
  paternityLeaveQuota Int               @default(0)
  workFromHomeQuota   Int               @default(4)
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  attendance          Attendance[]
  leaveRequests       LeaveRequest[]
  dailyLogs           ProjectDailyLog[]
  taskSubmissions     TaskSubmission[]
  tasks               Task[]

  @@map("employees")
}

model Project {
  id          String            @id @default(cuid())
  name        String            @unique
  clientName  String?
  status      ProjectStatus     @default(OnTrack)
  progress    Int               @default(0)
  startDate   DateTime?
  endDate     DateTime?
  description String?
  techStack   String?
  githubRepo  String?
  projectType ProjectType       @default(Company)
  assignedTo  String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  dailyLogs   ProjectDailyLog[]
  documents   ProjectDocument[]
  tasks       Task[]

  @@map("projects")
}

model ProjectDocument {
  id         String       @id @default(cuid())
  projectId  String
  title      String
  type       DocumentType @default(General)
  content    String?
  fileUrl    String?
  fileName   String?
  fileSize   Int?
  mimeType   String?
  uploadedBy String
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  project    Project      @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("project_documents")
}

model ProjectDailyLog {
  id          String      @id @default(cuid())
  projectId   String
  employeeId  String
  date        DateTime    @default(now())
  summary     String
  hoursWorked Float?
  category    LogCategory @default(General)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  employee    Employee    @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  project     Project     @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("project_daily_logs")
}

model Task {
  id             String             @id @default(cuid())
  title          String
  description    String?
  status         TaskStatus         @default(ToDo)
  priority       TaskPriority       @default(Medium)
  taskType       TaskType           @default(ProjectBased)
  dueDate        DateTime?
  attachments    String?
  approvalStatus TaskApprovalStatus @default(Approved)
  requestedBy    String?
  assigneeId     String?            // Employee ID (nullable for intern assignments)
  assigneeType   AssigneeType       @default(Employee) // Employee or Intern
  internId       String?            // Intern ID (nullable for employee assignments)
  projectId      String
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  assignments    TaskAssignment[]
  submissions    TaskSubmission[]
  assignee       Employee?          @relation(fields: [assigneeId], references: [id], onDelete: Cascade)
  intern         Intern?            @relation(fields: [internId], references: [id], onDelete: Cascade)
  project        Project            @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("tasks")
}

model TaskAssignment {
  id         String   @id @default(cuid())
  taskId     String
  employeeId String
  assignedAt DateTime @default(now())
  task       Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([taskId, employeeId])
  @@map("task_assignments")
}

model TaskSubmission {
  id          String   @id @default(cuid())
  taskId      String
  employeeId  String
  selfieUrl   String?
  notes       String?
  submittedAt DateTime @default(now())
  employee    Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  task        Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@map("task_submissions")
}

model Attendance {
  id         String           @id @default(cuid())
  employeeId String
  date       DateTime
  status     AttendanceStatus
  checkIn    String?
  checkOut   String?
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @updatedAt
  employee   Employee         @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, date])
  @@map("attendance")
}

model LeaveRequest {
  id            String        @id @default(cuid())
  employeeId    String
  startDate     DateTime
  endDate       DateTime
  leaveType     LeaveType     @default(Casual)
  leaveDuration LeaveDuration @default(FullDay)
  reason        String?
  status        LeaveStatus   @default(Pending)
  adminComment  String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  employee      Employee      @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("leave_requests")
}

model Intern {
  user              User?
  id                String              @id @default(cuid())
  name              String
  email             String              @unique
  phone             String?
  avatarUrl         String?
  university        String?
  degree            String?
  startDate         DateTime
  endDate           DateTime?
  status            InternStatus        @default(Upcoming)
  stipendAmount     Float?
  mentorId          String?
  project           String              @default("Unassigned")
  projects          String?             // JSON array of project names
  terminationDate   DateTime?
  terminationReason String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  evaluations       InternEvaluation[]
  stipendPayments   StipendPayment[]
  tasks             Task[]              // Tasks assigned to this intern

  @@map("interns")
}

model InternEvaluation {
  id          String   @id @default(cuid())
  internId    String
  mentorId    String
  mentorName  String
  rating      Int      // 1-5 scale
  feedback    String?
  skills      String?  // JSON object with skill ratings
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  intern      Intern   @relation(fields: [internId], references: [id], onDelete: Cascade)

  @@map("intern_evaluations")
}

model StipendPayment {
  id            String        @id @default(cuid())
  internId      String
  amount        Float
  paymentDate   DateTime
  paymentMethod String?
  status        PaymentStatus @default(Pending)
  notes         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  intern        Intern        @relation(fields: [internId], references: [id], onDelete: Cascade)

  @@map("stipend_payments")
}

enum Role {
  Developer
  Designer
  Manager
  QA
  Admin
  TeamLead
}

enum ProjectStatus {
  OnTrack
  AtRisk
  Completed
}

enum ProjectType {
  Company
  EmployeeSpecific
}

enum DocumentType {
  Environment
  Documentation
  Design
  General
}

enum TaskStatus {
  ToDo
  InProgress
  Done
}

enum TaskType {
  Daily
  ProjectBased
}

enum TaskApprovalStatus {
  Pending
  Approved
  Rejected
}

enum AttendanceStatus {
  Present
  Absent
  Late
  HalfDay
  OnLeave
}

enum LeaveStatus {
  Pending
  Approved
  Rejected
}

enum LeaveType {
  Casual
  Sick
  Earned
  Unpaid
  Maternity
  Paternity
  WorkFromHome
}

enum LeaveDuration {
  FullDay
  HalfDay
  FirstHalf
  SecondHalf
}

enum TaskPriority {
  Low
  Medium
  High
  Urgent
}

enum LogCategory {
  General
  Environment
  Deployment
  BugFix
  Feature
  Documentation
  Meeting
  Review
}

enum UserRole {
  admin
  employee
  intern
}

enum InternStatus {
  Upcoming
  Active
  Completed
  Terminated
}

enum PaymentStatus {
  Pending
  Paid
  Failed
}

enum AssigneeType {
  Employee
  Intern
}
